{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n\nvar _gsheetsapi = _interopRequireDefault(require(\"./gsheetsapi.js\"));\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    default: obj\n  };\n}\n\nfunction matchValues(valToMatch, valToMatchAgainst, matchingType) {\n  try {\n    if (typeof valToMatch != 'undefined') {\n      valToMatch = valToMatch.toLowerCase().trim();\n      valToMatchAgainst = valToMatchAgainst.toLowerCase().trim();\n\n      if (matchingType === 'strict') {\n        return valToMatch === valToMatchAgainst;\n      }\n\n      if (matchingType === 'loose') {\n        return valToMatch.includes(valToMatchAgainst) || valToMatch == valToMatchAgainst;\n      }\n    }\n  } catch (e) {\n    console.log(\"error in matchValues: \".concat(e.message));\n    return false;\n  }\n\n  return false;\n}\n\nfunction filterResults(resultsToFilter, filter, options) {\n  var filteredData = []; // now we have a list of rows, we can filter by various things\n\n  return resultsToFilter.filter(function (item) {\n    // item data shape\n    // item = {\n    //   'Module Name': 'name of module',\n    //   ...\n    //   Department: 'Computer science'\n    // }\n    var addRow = null;\n    var filterMatches = [];\n\n    if (typeof item === 'undefined' || item.length <= 0 || Object.keys(item).length <= 0) {\n      return false;\n    }\n\n    Object.keys(filter).forEach(function (key) {\n      var filterValue = filter[key]; // e.g. 'archaeology'\n      // need to find a matching item object key in case of case differences\n\n      var itemKey = Object.keys(item).find(function (thisKey) {\n        return thisKey.toLowerCase().trim() === key.toLowerCase().trim();\n      });\n      var itemValue = item[itemKey]; // e.g. 'department' or 'undefined'\n\n      filterMatches.push(matchValues(itemValue, filterValue, options.matching || 'loose'));\n    });\n\n    if (options.operator === 'or') {\n      addRow = filterMatches.some(function (match) {\n        return match === true;\n      });\n    }\n\n    if (options.operator === 'and') {\n      addRow = filterMatches.every(function (match) {\n        return match === true;\n      });\n    }\n\n    return addRow;\n  });\n}\n\nfunction processGSheetResults(JSONResponse, returnAllResults, filter, filterOptions) {\n  var data = JSONResponse.values;\n  var startRow = 1; // skip the header row(1), don't need it\n\n  var processedResults = [{}];\n  var colNames = {};\n\n  for (var i = 0; i < data.length; i++) {\n    // Rows\n    var thisRow = data[i];\n\n    for (var j = 0; j < thisRow.length; j++) {\n      // Columns/cells\n      var cellValue = thisRow[j];\n      var colNameToAdd = colNames[j]; // this will be undefined on the first pass\n\n      if (i < startRow) {\n        colNames[j] = cellValue;\n        continue; // skip the header row\n      }\n\n      if (typeof processedResults[i] === 'undefined') {\n        processedResults[i] = {};\n      }\n\n      if (typeof colNameToAdd !== 'undefined' && colNameToAdd.length > 0) {\n        processedResults[i][colNameToAdd] = cellValue;\n      }\n    }\n  } // make sure we're only returning valid, filled data items\n\n\n  processedResults = processedResults.filter(function (result) {\n    return Object.keys(result).length;\n  }); // if we're not filtering, then return all results\n\n  if (returnAllResults || !filter) {\n    return processedResults;\n  }\n\n  return filterResults(processedResults, filter, filterOptions);\n}\n\nvar gsheetProcessor = function gsheetProcessor(options, callback, onError) {\n  var apiKey = options.apiKey,\n      sheetId = options.sheetId,\n      sheetName = options.sheetName,\n      sheetNumber = options.sheetNumber,\n      returnAllResults = options.returnAllResults,\n      filter = options.filter,\n      filterOptions = options.filterOptions;\n\n  if (!options.apiKey || options.apiKey === undefined) {\n    throw new Error('Missing Sheets API key');\n  }\n\n  return (0, _gsheetsapi.default)({\n    apiKey: apiKey,\n    sheetId: sheetId,\n    sheetName: sheetName,\n    sheetNumber: sheetNumber\n  }).then(function (result) {\n    var filteredResults = processGSheetResults(result, returnAllResults || false, filter || false, filterOptions || {\n      operator: 'or',\n      matching: 'loose'\n    });\n    callback(filteredResults);\n  }).catch(function (err) {\n    return onError(err.message);\n  });\n};\n\nvar _default = gsheetProcessor;\nexports.default = _default;","map":{"version":3,"sources":["D:/Desktop/Nouveau dossier/my-app/node_modules/g-sheets-api/build/gsheetsprocessor.js"],"names":["Object","defineProperty","exports","value","default","_gsheetsapi","_interopRequireDefault","require","obj","__esModule","matchValues","valToMatch","valToMatchAgainst","matchingType","toLowerCase","trim","includes","e","console","log","concat","message","filterResults","resultsToFilter","filter","options","filteredData","item","addRow","filterMatches","length","keys","forEach","key","filterValue","itemKey","find","thisKey","itemValue","push","matching","operator","some","match","every","processGSheetResults","JSONResponse","returnAllResults","filterOptions","data","values","startRow","processedResults","colNames","i","thisRow","j","cellValue","colNameToAdd","result","gsheetProcessor","callback","onError","apiKey","sheetId","sheetName","sheetNumber","undefined","Error","then","filteredResults","catch","err","_default"],"mappings":"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","sourcesContent":["\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n\nvar _gsheetsapi = _interopRequireDefault(require(\"./gsheetsapi.js\"));\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction matchValues(valToMatch, valToMatchAgainst, matchingType) {\n  try {\n    if (typeof valToMatch != 'undefined') {\n      valToMatch = valToMatch.toLowerCase().trim();\n      valToMatchAgainst = valToMatchAgainst.toLowerCase().trim();\n\n      if (matchingType === 'strict') {\n        return valToMatch === valToMatchAgainst;\n      }\n\n      if (matchingType === 'loose') {\n        return valToMatch.includes(valToMatchAgainst) || valToMatch == valToMatchAgainst;\n      }\n    }\n  } catch (e) {\n    console.log(\"error in matchValues: \".concat(e.message));\n    return false;\n  }\n\n  return false;\n}\n\nfunction filterResults(resultsToFilter, filter, options) {\n  var filteredData = []; // now we have a list of rows, we can filter by various things\n\n  return resultsToFilter.filter(function (item) {\n    // item data shape\n    // item = {\n    //   'Module Name': 'name of module',\n    //   ...\n    //   Department: 'Computer science'\n    // }\n    var addRow = null;\n    var filterMatches = [];\n\n    if (typeof item === 'undefined' || item.length <= 0 || Object.keys(item).length <= 0) {\n      return false;\n    }\n\n    Object.keys(filter).forEach(function (key) {\n      var filterValue = filter[key]; // e.g. 'archaeology'\n      // need to find a matching item object key in case of case differences\n\n      var itemKey = Object.keys(item).find(function (thisKey) {\n        return thisKey.toLowerCase().trim() === key.toLowerCase().trim();\n      });\n      var itemValue = item[itemKey]; // e.g. 'department' or 'undefined'\n\n      filterMatches.push(matchValues(itemValue, filterValue, options.matching || 'loose'));\n    });\n\n    if (options.operator === 'or') {\n      addRow = filterMatches.some(function (match) {\n        return match === true;\n      });\n    }\n\n    if (options.operator === 'and') {\n      addRow = filterMatches.every(function (match) {\n        return match === true;\n      });\n    }\n\n    return addRow;\n  });\n}\n\nfunction processGSheetResults(JSONResponse, returnAllResults, filter, filterOptions) {\n  var data = JSONResponse.values;\n  var startRow = 1; // skip the header row(1), don't need it\n\n  var processedResults = [{}];\n  var colNames = {};\n\n  for (var i = 0; i < data.length; i++) {\n    // Rows\n    var thisRow = data[i];\n\n    for (var j = 0; j < thisRow.length; j++) {\n      // Columns/cells\n      var cellValue = thisRow[j];\n      var colNameToAdd = colNames[j]; // this will be undefined on the first pass\n\n      if (i < startRow) {\n        colNames[j] = cellValue;\n        continue; // skip the header row\n      }\n\n      if (typeof processedResults[i] === 'undefined') {\n        processedResults[i] = {};\n      }\n\n      if (typeof colNameToAdd !== 'undefined' && colNameToAdd.length > 0) {\n        processedResults[i][colNameToAdd] = cellValue;\n      }\n    }\n  } // make sure we're only returning valid, filled data items\n\n\n  processedResults = processedResults.filter(function (result) {\n    return Object.keys(result).length;\n  }); // if we're not filtering, then return all results\n\n  if (returnAllResults || !filter) {\n    return processedResults;\n  }\n\n  return filterResults(processedResults, filter, filterOptions);\n}\n\nvar gsheetProcessor = function gsheetProcessor(options, callback, onError) {\n  var apiKey = options.apiKey,\n      sheetId = options.sheetId,\n      sheetName = options.sheetName,\n      sheetNumber = options.sheetNumber,\n      returnAllResults = options.returnAllResults,\n      filter = options.filter,\n      filterOptions = options.filterOptions;\n\n  if (!options.apiKey || options.apiKey === undefined) {\n    throw new Error('Missing Sheets API key');\n  }\n\n  return (0, _gsheetsapi.default)({\n    apiKey: apiKey,\n    sheetId: sheetId,\n    sheetName: sheetName,\n    sheetNumber: sheetNumber\n  }).then(function (result) {\n    var filteredResults = processGSheetResults(result, returnAllResults || false, filter || false, filterOptions || {\n      operator: 'or',\n      matching: 'loose'\n    });\n    callback(filteredResults);\n  }).catch(function (err) {\n    return onError(err.message);\n  });\n};\n\nvar _default = gsheetProcessor;\nexports.default = _default;"]},"metadata":{},"sourceType":"script"}